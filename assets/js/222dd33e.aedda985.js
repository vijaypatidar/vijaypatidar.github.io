"use strict";(self.webpackChunkmy_portfolio=self.webpackChunkmy_portfolio||[]).push([[5462],{3766:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>g,frontMatter:()=>o,metadata:()=>a,toc:()=>c});var r=n(4848),i=n(8453);const o={slug:"Instrumenting-Spring-Boot-Applications-with-OpenTelemetry-Without-Java-Agent",title:"Instrumenting Spring Boot Applications with OpenTelemetry (Without Java Agent)",authors:["vijay"],tags:["java"]},s=void 0,a={permalink:"/blog/Instrumenting-Spring-Boot-Applications-with-OpenTelemetry-Without-Java-Agent",editUrl:"https://github.com/vijaypatidar/my-portfolio/tree/main/blog/2024-08-14-Instrumenting-Spring-Boot-Applications-with-OpenTelemetry-Without-Java-Agent/index.md",source:"@site/blog/2024-08-14-Instrumenting-Spring-Boot-Applications-with-OpenTelemetry-Without-Java-Agent/index.md",title:"Instrumenting Spring Boot Applications with OpenTelemetry (Without Java Agent)",description:"Introduction",date:"2024-08-14T00:00:00.000Z",tags:[{inline:!1,label:"Java",permalink:"/blog/tags/java",description:"Java"}],readingTime:2.235,hasTruncateMarker:!0,authors:[{name:"Vijay Patidar",title:"Fullstack Software Engineer",url:"https://github.com/vijaypatidar",imageURL:"https://github.com/vijaypatidar.png",key:"vijay",page:null}],frontMatter:{slug:"Instrumenting-Spring-Boot-Applications-with-OpenTelemetry-Without-Java-Agent",title:"Instrumenting Spring Boot Applications with OpenTelemetry (Without Java Agent)",authors:["vijay"],tags:["java"]},unlisted:!1,prevItem:{title:"When to choose MySql vs PostgreSql relation databse",permalink:"/blog/When-to-choose-MySql-vs-PostgreSql-relation-databse"},nextItem:{title:"What Is Stream In java",permalink:"/blog/what-is-stream-in-java"}},l={authorsImageUrls:[void 0]},c=[{value:"<strong>Introduction</strong>",id:"introduction",level:3},{value:"<strong>Step 1: Setting Up OpenTelemetry in Spring Boot</strong>",id:"step-1-setting-up-opentelemetry-in-spring-boot",level:3},{value:"<strong>Step 2: Configuring OpenTelemetry in Spring Boot</strong>",id:"step-2-configuring-opentelemetry-in-spring-boot",level:3},{value:"<strong>Step 3: Running Jaeger with Docker Compose</strong>",id:"step-3-running-jaeger-with-docker-compose",level:3},{value:"<strong>Step 4: Testing the Setup</strong>",id:"step-4-testing-the-setup",level:3},{value:"<strong>Conclusion</strong>",id:"conclusion",level:3}];function p(e){const t={code:"code",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.h3,{id:"introduction",children:(0,r.jsx)(t.strong,{children:"Introduction"})}),"\n",(0,r.jsx)(t.p,{children:"In modern distributed systems, observability is crucial for monitoring application performance and troubleshooting issues. OpenTelemetry (OTel) is a powerful tool for collecting telemetry data such as traces, metrics, and logs. In this guide, we'll walk through how to instrument a Spring Boot application with OpenTelemetry without using the Java agent, and how to export the telemetry data to Jaeger using Docker."}),"\n",(0,r.jsx)(t.h3,{id:"step-1-setting-up-opentelemetry-in-spring-boot",children:(0,r.jsx)(t.strong,{children:"Step 1: Setting Up OpenTelemetry in Spring Boot"})}),"\n",(0,r.jsx)(t.p,{children:"First, you'll need to add the necessary OpenTelemetry dependencies to your Spring Boot project. Here's how to do it with Gradle:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-groovy",children:'dependencies {\n    implementation(platform("io.opentelemetry.instrumentation:opentelemetry-instrumentation-bom:2.6.0"))\n    implementation("io.opentelemetry.instrumentation:opentelemetry-spring-boot-starter")\n}\n'})}),"\n",(0,r.jsx)(t.p,{children:"These dependencies bring in the OpenTelemetry SDK and the Spring Boot starter, which helps in auto-configuring the instrumentation of your application."}),"\n",(0,r.jsx)(t.h3,{id:"step-2-configuring-opentelemetry-in-spring-boot",children:(0,r.jsx)(t.strong,{children:"Step 2: Configuring OpenTelemetry in Spring Boot"})}),"\n",(0,r.jsxs)(t.p,{children:["Next, configure OpenTelemetry in your ",(0,r.jsx)(t.code,{children:"application.yml"})," (or ",(0,r.jsx)(t.code,{children:"application.properties"}),") to define how traces are exported and propagated:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"otel:\n  traces:\n    exporter: otlp\n  exporter:\n    otlp:\n      endpoint: http://localhost:4317\n      protocol: grpc\n  propagators:\n    - tracecontext\n  resource:\n    attributes:\n      deployment.environment: dev\n      service:\n        name: webflux\n        namespace: spring\n"})}),"\n",(0,r.jsx)(t.p,{children:"Here\u2019s what each part does:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"traces.exporter.otlp"}),": Specifies the OTLP (OpenTelemetry Protocol) as the exporter."]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"exporter.otlp.endpoint"}),": The endpoint where the traces will be sent."]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"propagators"}),": Configures the trace context propagation."]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"resource.attributes"}),": Adds metadata like environment and service name to the traces."]}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"step-3-running-jaeger-with-docker-compose",children:(0,r.jsx)(t.strong,{children:"Step 3: Running Jaeger with Docker Compose"})}),"\n",(0,r.jsxs)(t.p,{children:["To visualize the traces, you'll need a tool like Jaeger. Here\u2019s a ",(0,r.jsx)(t.code,{children:"docker-compose.yml"})," setup that runs Jaeger with Elasticsearch as the storage backend:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:'version: "3.7"\n\nservices:\n  jaeger-collector:\n    image: jaegertracing/jaeger-collector:1.40\n    environment:\n      - COLLECTOR_OTLP_ENABLED=true # Enable OTLP endpoint\n      - SPAN_STORAGE_TYPE=elasticsearch\n      - ES_SERVER_URLS=http://elasticsearch:9200\n    ports:\n      - "14250:14250" # OTLP gRPC\n      - "14268:14268" # Jaeger HTTP Thrift\n      - "4317:4317" # OTLP gRPC for traces\n      - "4318:4318" # OTLP HTTP for traces\n    depends_on:\n      - elasticsearch\n    networks:\n      - jaeger-network\n\n  jaeger-query:\n    image: jaegertracing/jaeger-query:1.40\n    environment:\n      - SPAN_STORAGE_TYPE=elasticsearch\n      - ES_SERVER_URLS=http://elasticsearch:9200\n    ports:\n      - "16686:16686" # Jaeger UI\n    depends_on:\n      - jaeger-collector\n    networks:\n      - jaeger-network\n\n  elasticsearch:\n    image: docker.elastic.co/elasticsearch/elasticsearch:7.10.2\n    environment:\n      - discovery.type=single-node\n    ports:\n      - "9200:9200"\n    networks:\n      - jaeger-network\n\nnetworks:\n  jaeger-network:\n    driver: bridge\n'})}),"\n",(0,r.jsx)(t.p,{children:"This setup creates three services:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Jaeger Collector"}),": Collects traces from your application."]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Jaeger Query"}),": Provides a UI to view and query traces."]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Elasticsearch"}),": Stores the trace data."]}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"step-4-testing-the-setup",children:(0,r.jsx)(t.strong,{children:"Step 4: Testing the Setup"})}),"\n",(0,r.jsxs)(t.p,{children:["Once everything is configured, start your application and the Docker Compose setup. Generate some traffic in your application to produce traces. You should see the traces appear in the Jaeger UI at ",(0,r.jsx)(t.code,{children:"http://localhost:16686"}),"."]}),"\n",(0,r.jsx)(t.h3,{id:"conclusion",children:(0,r.jsx)(t.strong,{children:"Conclusion"})}),"\n",(0,r.jsx)(t.p,{children:"By following these steps, you've successfully instrumented your Spring Boot application with OpenTelemetry, configured it to export traces to Jaeger, and visualized the traces without using the OpenTelemetry Java agent. This approach offers flexibility and control over how your application is instrumented."})]})}function g(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(p,{...e})}):p(e)}}}]);